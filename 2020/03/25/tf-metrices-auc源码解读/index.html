<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力成为一名实力很强的小白"><title>tf.metrices.auc源码解读 | TiuVe</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">tf.metrices.auc源码解读</h1><a id="logo" href="/.">TiuVe</a><p class="description">气蒸云梦泽，波撼岳阳城</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/./archives/"><i class="fa fa-archive"> 归档</i></a><a href="/./about/about.html"><i class="fa fa-user"> 关于</i></a><a href="/./project/project.html"><i class="fa fa-archive"> work</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">tf.metrices.auc源码解读</h1><div class="post-meta"><a href="/2020/03/25/tf-metrices-auc源码解读/#comments" class="comment-count"></a><p><span class="date">Mar 25, 2020</span><span><a href="/categories/tensorflow/" class="category">tensorflow</a></span></p></div><div class="post-content"><p>auc是机器学习二分类问题的常用指标，其反映了分类器对正负样本的排序能力，换句话说，auc反映了模型对正负样本的区分能力。常用的auc计算方式有两种，一种是tensorflow的tf.metrics.auc函数，另一种是sklearn中的roc_auc_score()函数。二者都是通过极限逼近的思想，计算roc曲线下面积的一个个小梯形的面积和得到auc。不过有点奇怪的是，这两个函数计算出来的auc值并不总是相似的，有时会差别比较大，所以想分析下。本文先看下tf.metrics.auc的实现。</p>
<p>首先看下tf.metrics.auc的函数定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@tf_export('metrics.auc')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auc</span><span class="params">(labels,</span></span></span><br><span class="line"><span class="function"><span class="params">        predictions,</span></span></span><br><span class="line"><span class="function"><span class="params">        weights=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        num_thresholds=<span class="number">200</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        metrics_collections=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        updates_collections=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        curve=<span class="string">'ROC'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        name=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        summation_method=<span class="string">'trapezoidal'</span>)</span></span></span><br></pre></td></tr></table></figure>

<p>tf.metrics.auc的参数有三个比较重要。labels和predictions是必须参数，labels就是二分类问题的类别集合，一般就是0&#x2F;1的集合，predictions就是模型的预测得分集合，是一个0-1的浮点数的集合。num_thresholds参数也很重要，这个参数控制了划分成多少个梯形计算面积。默认是200，可以根据batch大小进行调整。</p>
<p>再看下tf.metrics.auc的具体实现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta"> @tf_export('metrics.auc')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">auc</span><span class="params">(labels,</span></span></span><br><span class="line"><span class="function"><span class="params">        predictions,</span></span></span><br><span class="line"><span class="function"><span class="params">        weights=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        num_thresholds=<span class="number">200</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        metrics_collections=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        updates_collections=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        curve=<span class="string">'ROC'</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">        name=None,</span></span></span><br><span class="line"><span class="function"><span class="params">        summation_method=<span class="string">'trapezoidal'</span>)</span>:</span></span><br><span class="line">  <span class="keyword">if</span> context.executing_eagerly():</span><br><span class="line">    <span class="keyword">raise</span> RuntimeError(<span class="string">'tf.metrics.auc is not supported when eager execution '</span></span><br><span class="line">                       <span class="string">'is enabled.'</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">with</span> variable_scope.variable_scope(name, <span class="string">'auc'</span>,</span><br><span class="line">                                     (labels, predictions, weights)):</span><br><span class="line">    <span class="keyword">if</span> curve != <span class="string">'ROC'</span> <span class="keyword">and</span> curve != <span class="string">'PR'</span>:</span><br><span class="line">      <span class="keyword">raise</span> ValueError(<span class="string">'curve must be either ROC or PR, %s unknown'</span> % (curve))</span><br><span class="line">    kepsilon = <span class="number">1e-7</span>  <span class="comment"># to account for floating point imprecisions</span></span><br><span class="line">    thresholds = [</span><br><span class="line">        (i + <span class="number">1</span>) * <span class="number">1.0</span> / (num_thresholds - <span class="number">1</span>) <span class="keyword">for</span> i <span class="keyword">in</span> range(num_thresholds - <span class="number">2</span>)</span><br><span class="line">    ] <span class="comment"># thresholds是在[0-1]中分num_thresholds个段，而首尾加一个微量值避免0和1.</span></span><br><span class="line">    thresholds = [<span class="number">0.0</span> - kepsilon] + thresholds + [<span class="number">1.0</span> + kepsilon]</span><br><span class="line"></span><br><span class="line">    values, update_ops = _confusion_matrix_at_thresholds(</span><br><span class="line">        labels, predictions, thresholds, weights)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add epsilons to avoid dividing by 0.</span></span><br><span class="line">    epsilon = <span class="number">1.0e-6</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">interpolate_pr_auc</span><span class="params">(tp, fp, fn)</span>:</span></span><br><span class="line">      dtp = tp[:num_thresholds - <span class="number">1</span>] - tp[<span class="number">1</span>:]</span><br><span class="line">      p = tp + fp</span><br><span class="line">      prec_slope = _safe_div(dtp, p[:num_thresholds - <span class="number">1</span>] - p[<span class="number">1</span>:], <span class="string">'prec_slope'</span>)</span><br><span class="line">      intercept = tp[<span class="number">1</span>:] - math_ops.multiply(prec_slope, p[<span class="number">1</span>:])</span><br><span class="line">      safe_p_ratio = array_ops.where(</span><br><span class="line">          math_ops.logical_and(p[:num_thresholds - <span class="number">1</span>] &gt; <span class="number">0</span>, p[<span class="number">1</span>:] &gt; <span class="number">0</span>),</span><br><span class="line">          _safe_div(p[:num_thresholds - <span class="number">1</span>], p[<span class="number">1</span>:], <span class="string">'recall_relative_ratio'</span>),</span><br><span class="line">          array_ops.ones_like(p[<span class="number">1</span>:]))</span><br><span class="line">      <span class="keyword">return</span> math_ops.reduce_sum(</span><br><span class="line">          _safe_div(</span><br><span class="line">              prec_slope * (dtp + intercept * math_ops.log(safe_p_ratio)),</span><br><span class="line">              tp[<span class="number">1</span>:] + fn[<span class="number">1</span>:],</span><br><span class="line">              name=<span class="string">'pr_auc_increment'</span>),</span><br><span class="line">          name=<span class="string">'interpolate_pr_auc'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute_auc</span><span class="params">(tp, fn, tn, fp, name)</span>:</span></span><br><span class="line">      <span class="string">"""Computes the roc-auc or pr-auc based on confusion counts."""</span></span><br><span class="line">      <span class="keyword">if</span> curve == <span class="string">'PR'</span>:</span><br><span class="line">        <span class="keyword">if</span> summation_method == <span class="string">'trapezoidal'</span>:</span><br><span class="line">          logging.warning(</span><br><span class="line">              <span class="string">'Trapezoidal rule is known to produce incorrect PR-AUCs; '</span></span><br><span class="line">              <span class="string">'please switch to "careful_interpolation" instead.'</span>)</span><br><span class="line">        <span class="keyword">elif</span> summation_method == <span class="string">'careful_interpolation'</span>:</span><br><span class="line">          <span class="comment"># This one is a bit tricky and is handled separately.</span></span><br><span class="line">          <span class="keyword">return</span> interpolate_pr_auc(tp, fp, fn)</span><br><span class="line">      rec = math_ops.div(tp + epsilon, tp + fn + epsilon) <span class="comment">#  math_ops.div()除法</span></span><br><span class="line">      <span class="keyword">if</span> curve == <span class="string">'ROC'</span>: <span class="comment">#auc是roc曲线的下面积</span></span><br><span class="line">        fp_rate = math_ops.div(fp, fp + tn + epsilon)</span><br><span class="line">        x = fp_rate</span><br><span class="line">        y = rec</span><br><span class="line">      <span class="keyword">else</span>:  <span class="comment"># curve == 'PR'.</span></span><br><span class="line">        prec = math_ops.div(tp + epsilon, tp + fp + epsilon)</span><br><span class="line">        x = rec</span><br><span class="line">        y = prec</span><br><span class="line">      <span class="keyword">if</span> summation_method <span class="keyword">in</span> (<span class="string">'trapezoidal'</span>, <span class="string">'careful_interpolation'</span>): <span class="comment">#默认参数是trapezoidal</span></span><br><span class="line">        <span class="comment"># Note that the case ('PR', 'careful_interpolation') has been handled</span></span><br><span class="line">        <span class="comment"># above.</span></span><br><span class="line">        <span class="keyword">return</span> math_ops.reduce_sum(</span><br><span class="line">            math_ops.multiply(x[:num_thresholds - <span class="number">1</span>] - x[<span class="number">1</span>:],</span><br><span class="line">                              (y[:num_thresholds - <span class="number">1</span>] + y[<span class="number">1</span>:]) / <span class="number">2.</span>),</span><br><span class="line">            name=name)</span><br><span class="line">      <span class="keyword">elif</span> summation_method == <span class="string">'minoring'</span>:</span><br><span class="line">        <span class="keyword">return</span> math_ops.reduce_sum(</span><br><span class="line">            math_ops.multiply(x[:num_thresholds - <span class="number">1</span>] - x[<span class="number">1</span>:],</span><br><span class="line">                              math_ops.minimum(y[:num_thresholds - <span class="number">1</span>], y[<span class="number">1</span>:])),</span><br><span class="line">            name=name)</span><br><span class="line">      <span class="keyword">elif</span> summation_method == <span class="string">'majoring'</span>:</span><br><span class="line">        <span class="keyword">return</span> math_ops.reduce_sum(</span><br><span class="line">            math_ops.multiply(x[:num_thresholds - <span class="number">1</span>] - x[<span class="number">1</span>:],</span><br><span class="line">                              math_ops.maximum(y[:num_thresholds - <span class="number">1</span>], y[<span class="number">1</span>:])),</span><br><span class="line">            name=name)</span><br><span class="line">      <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Invalid summation_method: %s'</span> % summation_method)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># sum up the areas of all the trapeziums</span></span><br><span class="line">    auc_value = compute_auc(values[<span class="string">'tp'</span>], values[<span class="string">'fn'</span>], values[<span class="string">'tn'</span>],</span><br><span class="line">                            values[<span class="string">'fp'</span>], <span class="string">'value'</span>)</span><br><span class="line">    update_op = compute_auc(update_ops[<span class="string">'tp'</span>], update_ops[<span class="string">'fn'</span>],</span><br><span class="line">                            update_ops[<span class="string">'tn'</span>], update_ops[<span class="string">'fp'</span>], <span class="string">'update_op'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> metrics_collections:</span><br><span class="line">      ops.add_to_collections(metrics_collections, auc_value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> updates_collections:</span><br><span class="line">      ops.add_to_collections(updates_collections, update_op)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> auc_value, update_op</span><br></pre></td></tr></table></figure>

<p>tf.metrics.auc函数返回了两个值auc_value和update_op。auc_value就是我们需要的值，但是需要注意的是，只有必须先sess.run(update_op)之后才可以得到auc_value值。怎么理解呢？看下面代码就明白了。原因在后面介绍。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auc_value, update_op = tf.metrics.auc(labels=target, predictions=predictions_score, name=<span class="string">"auc_metric"</span>, num_thresholds=<span class="number">512</span>)</span><br><span class="line">_ = sess.run(update_op)</span><br><span class="line">auc = sess.run(auc_value)</span><br></pre></td></tr></table></figure>

<p>看第87-90代码可知，auc_value和update_op是通过一个compute_auc()函数计算得到的，compute_auc()的传入参数貌似是混淆矩阵的四个值。</p>
<p>而在compute_auc函数中，57-61行中计算了真正例率rec和假正例率fp_rate，分别对应roc曲线的横坐标x和纵坐标y。66-72行计算了roc曲线下面积的小梯形之和。也就是说<strong>compute_auc()函数传入的是混淆矩阵的四个值，通过计算roc曲线下面积的小梯形之和得到auc返回</strong>。</p>
<p>再回过来看下97-90行，auc_value和update_op不同在于values和update_ops变量，update_op貌似是个op，而auc_value是标量值。values, update_ops的计算在25行的_confusion_matrix_at_thresholds()函数，其传入的参数是分别是labels, predictions, thresholds, weights(默认值None)。labels, predictions不多说，而thresholds是在[0-1]中分num_thresholds个段，而首尾加一个微量值避免0和1。可以猜想下，是根据num_thresholds个段作为分类阈值计算混淆矩阵的。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_confusion_matrix_at_thresholds</span><span class="params">(labels,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    predictions,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    thresholds,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    weights=None,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    includes=None)</span>:</span></span><br><span class="line">  all_includes = (<span class="string">'tp'</span>, <span class="string">'fn'</span>, <span class="string">'tn'</span>, <span class="string">'fp'</span>)</span><br><span class="line">  <span class="keyword">if</span> includes <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    includes = all_includes</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">for</span> include <span class="keyword">in</span> includes:</span><br><span class="line">      <span class="keyword">if</span> include <span class="keyword">not</span> <span class="keyword">in</span> all_includes:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">'Invalid key: %s.'</span> % include)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">with</span> ops.control_dependencies([</span><br><span class="line">      check_ops.assert_greater_equal( <span class="comment">#断言，检查输入</span></span><br><span class="line">          predictions,</span><br><span class="line">          math_ops.cast(<span class="number">0.0</span>, dtype=predictions.dtype),</span><br><span class="line">          message=<span class="string">'predictions must be in [0, 1]'</span>),</span><br><span class="line">      check_ops.assert_less_equal(</span><br><span class="line">          predictions,</span><br><span class="line">          math_ops.cast(<span class="number">1.0</span>, dtype=predictions.dtype),</span><br><span class="line">          message=<span class="string">'predictions must be in [0, 1]'</span>)</span><br><span class="line">  ]):</span><br><span class="line">    <span class="comment"># 对predictions和labels进行类型规范</span></span><br><span class="line">    predictions, labels, weights = _remove_squeezable_dimensions(  </span><br><span class="line">        predictions=math_ops.to_float(predictions),</span><br><span class="line">        labels=math_ops.cast(labels, dtype=dtypes.bool),</span><br><span class="line">        weights=weights)</span><br><span class="line"></span><br><span class="line">  num_thresholds = len(thresholds)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Reshape predictions and labels.</span></span><br><span class="line">  predictions_2d = array_ops.reshape(predictions, [<span class="number">-1</span>, <span class="number">1</span>])</span><br><span class="line">  labels_2d = array_ops.reshape(</span><br><span class="line">      math_ops.cast(labels, dtype=dtypes.bool), [<span class="number">1</span>, <span class="number">-1</span>])</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Use static shape if known.</span></span><br><span class="line">  num_predictions = predictions_2d.get_shape().as_list()[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Otherwise use dynamic shape.</span></span><br><span class="line">  <span class="keyword">if</span> num_predictions <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">    num_predictions = array_ops.shape(predictions_2d)[<span class="number">0</span>]</span><br><span class="line">  thresh_tiled = array_ops.tile( <span class="comment"># tile之后产生了num_thresholds*num_predictions的阈值矩阵</span></span><br><span class="line">      array_ops.expand_dims(array_ops.constant(thresholds), [<span class="number">1</span>]), <span class="comment">#expand_dims和reshape等价，但是palceloader无法使用reshape，这里产生了num_thresholds*1的阈值矩阵</span></span><br><span class="line">      array_ops.stack([<span class="number">1</span>, num_predictions])) <span class="comment">#stack之后产生了[1,num_predictions]</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># Tile the predictions after thresholding them across different thresholds.</span></span><br><span class="line">  pred_is_pos = math_ops.greater(</span><br><span class="line">      array_ops.tile(array_ops.transpose(predictions_2d), [num_thresholds, <span class="number">1</span>]),</span><br><span class="line">      thresh_tiled)</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'fn'</span> <span class="keyword">in</span> includes) <span class="keyword">or</span> (<span class="string">'tn'</span> <span class="keyword">in</span> includes):</span><br><span class="line">    pred_is_neg = math_ops.logical_not(pred_is_pos)</span><br><span class="line"></span><br><span class="line">  <span class="comment"># Tile labels by number of thresholds</span></span><br><span class="line">  label_is_pos = array_ops.tile(labels_2d, [num_thresholds, <span class="number">1</span>])</span><br><span class="line">  <span class="keyword">if</span> (<span class="string">'fp'</span> <span class="keyword">in</span> includes) <span class="keyword">or</span> (<span class="string">'tn'</span> <span class="keyword">in</span> includes):</span><br><span class="line">    label_is_neg = math_ops.logical_not(label_is_pos)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> weights <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">    weights = weights_broadcast_ops.broadcast_weights(</span><br><span class="line">        math_ops.to_float(weights), predictions)</span><br><span class="line">    weights_tiled = array_ops.tile(</span><br><span class="line">        array_ops.reshape(weights, [<span class="number">1</span>, <span class="number">-1</span>]), [num_thresholds, <span class="number">1</span>])</span><br><span class="line">    thresh_tiled.get_shape().assert_is_compatible_with(</span><br><span class="line">        weights_tiled.get_shape())</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    weights_tiled = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">  values = &#123;&#125;</span><br><span class="line">  update_ops = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="string">'tp'</span> <span class="keyword">in</span> includes:</span><br><span class="line">    true_p = metric_variable(</span><br><span class="line">        [num_thresholds], dtypes.float32, name=<span class="string">'true_positives'</span>)</span><br><span class="line">    is_true_positive = math_ops.to_float(</span><br><span class="line">        math_ops.logical_and(label_is_pos, pred_is_pos))</span><br><span class="line">    <span class="keyword">if</span> weights_tiled <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">      is_true_positive *= weights_tiled</span><br><span class="line">    update_ops[<span class="string">'tp'</span>] = state_ops.assign_add(true_p,</span><br><span class="line">                                            math_ops.reduce_sum(</span><br><span class="line">                                                is_true_positive, <span class="number">1</span>)) <span class="comment">#1是维度</span></span><br><span class="line">    values[<span class="string">'tp'</span>] = true_p</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="string">'fn'</span> <span class="keyword">in</span> includes:</span><br><span class="line">    false_n = metric_variable(</span><br><span class="line">        [num_thresholds], dtypes.float32, name=<span class="string">'false_negatives'</span>)</span><br><span class="line">    is_false_negative = math_ops.to_float(</span><br><span class="line">        math_ops.logical_and(label_is_pos, pred_is_neg))</span><br><span class="line">    <span class="keyword">if</span> weights_tiled <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">      is_false_negative *= weights_tiled</span><br><span class="line">    update_ops[<span class="string">'fn'</span>] = state_ops.assign_add(false_n,</span><br><span class="line">                                            math_ops.reduce_sum(</span><br><span class="line">                                                is_false_negative, <span class="number">1</span>))</span><br><span class="line">    values[<span class="string">'fn'</span>] = false_n</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="string">'tn'</span> <span class="keyword">in</span> includes:</span><br><span class="line">    true_n = metric_variable(</span><br><span class="line">        [num_thresholds], dtypes.float32, name=<span class="string">'true_negatives'</span>)</span><br><span class="line">    is_true_negative = math_ops.to_float(</span><br><span class="line">        math_ops.logical_and(label_is_neg, pred_is_neg))</span><br><span class="line">    <span class="keyword">if</span> weights_tiled <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">      is_true_negative *= weights_tiled</span><br><span class="line">    update_ops[<span class="string">'tn'</span>] = state_ops.assign_add(true_n,</span><br><span class="line">                                            math_ops.reduce_sum(</span><br><span class="line">                                                is_true_negative, <span class="number">1</span>))</span><br><span class="line">    values[<span class="string">'tn'</span>] = true_n</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> <span class="string">'fp'</span> <span class="keyword">in</span> includes:</span><br><span class="line">    false_p = metric_variable(</span><br><span class="line">        [num_thresholds], dtypes.float32, name=<span class="string">'false_positives'</span>)</span><br><span class="line">    is_false_positive = math_ops.to_float(</span><br><span class="line">        math_ops.logical_and(label_is_neg, pred_is_pos))</span><br><span class="line">    <span class="keyword">if</span> weights_tiled <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">      is_false_positive *= weights_tiled</span><br><span class="line">    update_ops[<span class="string">'fp'</span>] = state_ops.assign_add(false_p,</span><br><span class="line">                                            math_ops.reduce_sum(</span><br><span class="line">                                                is_false_positive, <span class="number">1</span>))</span><br><span class="line">    values[<span class="string">'fp'</span>] = false_p</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> values, update_ops</span><br></pre></td></tr></table></figure>

<p>以values[‘tp’]为例看下values是怎么得到的(72-82行)。可以看到<code>values[&#39;tp&#39;] = true_p</code>，而在73行true_p还没有赋值，仅仅是通过metric_variable()函数创建本地变量（Create variable in <code>GraphKeys.(LOCAL|METRIC_VARIABLES</code>) collections）。在第75行计算了真正例is_true_positive（真正例简称tp，即真实label是正例且预测也是正例），然后79行将tp和通过函数assign_add()加到了true_p上，然后返回op赋值给update_ops[‘tp’]。最后true_p赋值给了values[‘tp’]。**需要注意的是assign_add()返回的是op，所以如果想得到true_p的值必须先计算op(update_ops[‘tp’])**，这就解释了上文的问题。可以再看下assign_add()定义：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@tf_export("assign_add")</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">assign_add</span><span class="params">(ref, value, use_locking=None, name=None)</span>:</span></span><br><span class="line">  <span class="string">"""Update 'ref' by adding 'value' to it.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  This operation outputs "ref" after the update is done.先更新才可以得到ref</span></span><br><span class="line"><span class="string">  This makes it easier to chain operations that need to use the reset value.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    ref: A mutable `Tensor`. Must be one of the following types:</span></span><br><span class="line"><span class="string">      `float32`, `float64`, `int64`, `int32`, `uint8`, `uint16`, `int16`,</span></span><br><span class="line"><span class="string">      `int8`, `complex64`, `complex128`, `qint8`, `quint8`, `qint32`, `half`.</span></span><br><span class="line"><span class="string">      Should be from a `Variable` node.</span></span><br><span class="line"><span class="string">    value: A `Tensor`. Must have the same type as `ref`.</span></span><br><span class="line"><span class="string">      The value to be added to the variable.</span></span><br><span class="line"><span class="string">    use_locking: An optional `bool`. Defaults to `False`.</span></span><br><span class="line"><span class="string">      If True, the addition will be protected by a lock;</span></span><br><span class="line"><span class="string">      otherwise the behavior is undefined, but may exhibit less contention.</span></span><br><span class="line"><span class="string">    name: A name for the operation (optional).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    Same as "ref".  Returned as a convenience for operations that want</span></span><br><span class="line"><span class="string">    to use the new value after the variable has been updated.</span></span><br><span class="line"><span class="string">  """</span></span><br></pre></td></tr></table></figure>

<p>然后看下怎么计算真正例is_true_positive的。<code>math_ops.logical_and(label_is_pos, pred_is_pos)</code>是对label_is_pos和pred_is_pos进行与操作。现在问题变成了分析label_is_pos和pred_is_pos是怎么来的。看58-59行。<code>array_ops.tile(array_ops.transpose(predictions_2d), [num_thresholds, 1])</code>得到的是num_thresholds*num_predictions的矩阵A，array_ops.transpose(predictions_2d)是1*n的矩阵，n对应batch大小为n的n个得分。使用tile沿着第0维复制num_thresholds次。thresh_tiled是num_thresholds*num_predictions的阈值矩阵。使用math_ops.greater()函数之后，如果predictions中元素大于阈值则返回True，否则False，最后得到了值为True&#x2F;False的list，也就是pred_is_pos（预测为正），其它同理。所以在76行通过logical_and得到了is_true_positive真正例。</p>
<p>emm，大概就这样。</p>
</div><div class="tags"><a href="/tags/auc/">auc</a><a href="/tags/tf/">tf</a></div><script type="text/javascript" src="/js/jquery.js?v=2.0.1" async></script><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>谢谢~ 您的支持将鼓励我继续创作！<br></div></div><div id="donate_guide" class="donate_bar center hidden pay"><img src="/img/weChatMoney.png" title="微信打赏" alt="微信打赏"><img src="/img/alipayMoney.png" title="支付宝打赏" alt="支付宝打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2020/03/26/sklearn-roc-auc-score源码解读/" class="pre">sklearn roc_auc_score源码解读</a><a href="/2020/03/19/auc是什么/" class="next">auc是什么</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80MTIyOC8xNzc3Ng=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2023/03/29/《Contrastive-Learning-for-Cold-Start-Recommendation》阅读笔记/">《ACM MM2021 Contrastive Learning for Cold-Start Recommendation》阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/09/07/《KDD2018-Perceive-Your-Users-in-Depth-Learning-Universal-User-Representations-from-Multiple-E-commerce-Tasks》阅读笔记/">《KDD2018 Perceive Your Users in Depth Learning Universal User Representations from Multiple E-commerce Tasks》阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/08/10/《Parameter-Efficient-Transfer-from-Sequential-Behaviors-for-User-Modeling-and-Recommendation》论文阅读/">《Parameter-Efficient Transfer from Sequential Behaviors for User Modeling and Recommendation》论文阅读</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/07/03/《Towards-Universal-Sequence-Representation-Learning-for-Recommender-Systems》论文阅读笔记/">《Towards Universal Sequence Representation Learning for Recommender Systems》论文阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/07/NLP相关资料整理/">NLP相关资料整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/05/hexo博客链接在微信被屏蔽的解决办法/">hexo博客链接在微信被屏蔽的解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/05/TensorFlow的自动求导具体是在哪部分代码里实现的？/">TensorFlow的自动求导具体是在哪部分代码里实现的？</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/05/tf中如何修改tensor的值/">tf中如何修改tensor的值</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/04/解决tf1-15中tf-scatter-update-函数没有定义梯度的问题/">解决tf1.15中tf.scatter_update()函数没有定义梯度的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/31/解决hexo博客代码在IOS下字体过大的问题/">解决hexo博客代码在IOS下字体过大的问题</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DMMLAI/">DMMLAI</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo主题/">Hexo主题</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hive/">Hive</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PL/">PL</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Story/">Story</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hole/">hole</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pytorch/">pytorch</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sklearn/">sklearn</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tensorflow/">tensorflow</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/例行化/">例行化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发/">开发</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发工具/">开发工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/推荐/">推荐</a><span class="category-list-count">7</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/摄影/">摄影</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据获取/">数据获取</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/深度学习/">深度学习</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/游记/">游记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/爬虫/">爬虫</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/统计学/">统计学</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算广告/">计算广告</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/高并发/">高并发</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/思考/" style="font-size: 15px;">思考</a> <a href="/tags/cold/" style="font-size: 15px;">cold</a> <a href="/tags/gwen/" style="font-size: 15px;">gwen</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/FTRL/" style="font-size: 15px;">FTRL</a> <a href="/tags/hive/" style="font-size: 15px;">hive</a> <a href="/tags/Java编程思想/" style="font-size: 15px;">Java编程思想</a> <a href="/tags/kmp/" style="font-size: 15px;">kmp</a> <a href="/tags/字符串匹配/" style="font-size: 15px;">字符串匹配</a> <a href="/tags/L2范数，范数/" style="font-size: 15px;">L2范数，范数</a> <a href="/tags/linux性能管理/" style="font-size: 15px;">linux性能管理</a> <a href="/tags/NLP/" style="font-size: 15px;">NLP</a> <a href="/tags/tensorflow/" style="font-size: 15px;">tensorflow</a> <a href="/tags/自动求导，自动微分/" style="font-size: 15px;">自动求导，自动微分</a> <a href="/tags/sublime/" style="font-size: 15px;">sublime</a> <a href="/tags/TFRecord/" style="font-size: 15px;">TFRecord</a> <a href="/tags/FM/" style="font-size: 15px;">FM</a> <a href="/tags/指标/" style="font-size: 15px;">指标</a> <a href="/tags/auc/" style="font-size: 15px;">auc</a> <a href="/tags/zookepper/" style="font-size: 15px;">zookepper</a> <a href="/tags/centos7/" style="font-size: 15px;">centos7</a> <a href="/tags/cpm/" style="font-size: 15px;">cpm</a> <a href="/tags/opcm/" style="font-size: 15px;">opcm</a> <a href="/tags/ecpm/" style="font-size: 15px;">ecpm</a> <a href="/tags/hexo，微信屏蔽/" style="font-size: 15px;">hexo，微信屏蔽</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/tf/" style="font-size: 15px;">tf</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/重装系统/" style="font-size: 15px;">重装系统</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/OJ/" style="font-size: 15px;">OJ</a> <a href="/tags/dfs/" style="font-size: 15px;">dfs</a> <a href="/tags/递归/" style="font-size: 15px;">递归</a> <a href="/tags/poj/" style="font-size: 15px;">poj</a> <a href="/tags/回文字符串/" style="font-size: 15px;">回文字符串</a> <a href="/tags/dp/" style="font-size: 15px;">dp</a> <a href="/tags/暴力/" style="font-size: 15px;">暴力</a> <a href="/tags/棋盘规则/" style="font-size: 15px;">棋盘规则</a> <a href="/tags/状态压缩/" style="font-size: 15px;">状态压缩</a> <a href="/tags/BFS/" style="font-size: 15px;">BFS</a> <a href="/tags/位运算/" style="font-size: 15px;">位运算</a> <a href="/tags/pytorch/" style="font-size: 15px;">pytorch</a> <a href="/tags/module/" style="font-size: 15px;">module</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/质数/" style="font-size: 15px;">质数</a> <a href="/tags/素数/" style="font-size: 15px;">素数</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/sklearn/" style="font-size: 15px;">sklearn</a> <a href="/tags/hole/" style="font-size: 15px;">hole</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/打散/" style="font-size: 15px;">打散</a> <a href="/tags/roc-auc-score/" style="font-size: 15px;">roc_auc_score</a> <a href="/tags/svm多类别分类/" style="font-size: 15px;">svm多类别分类</a> <a href="/tags/网格搜索/" style="font-size: 15px;">网格搜索</a> <a href="/tags/textFile/" style="font-size: 15px;">textFile</a> <a href="/tags/源码剖析/" style="font-size: 15px;">源码剖析</a> <a href="/tags/rdd计算/" style="font-size: 15px;">rdd计算</a> <a href="/tags/smoothing/" style="font-size: 15px;">smoothing</a> <a href="/tags/tensorboard/" style="font-size: 15px;">tensorboard</a> <a href="/tags/test-in-ubuntu/" style="font-size: 15px;">test in ubuntu</a> <a href="/tags/tf-nn/" style="font-size: 15px;">tf.nn</a> <a href="/tags/tensor/" style="font-size: 15px;">tensor</a> <a href="/tags/gather/" style="font-size: 15px;">gather</a> <a href="/tags/cnn/" style="font-size: 15px;">cnn</a> <a href="/tags/transformer/" style="font-size: 15px;">transformer</a> <a href="/tags/nlp/" style="font-size: 15px;">nlp</a> <a href="/tags/trie/" style="font-size: 15px;">trie</a> <a href="/tags/推荐，对比学习，冷启动/" style="font-size: 15px;">推荐，对比学习，冷启动</a> <a href="/tags/word2vec/" style="font-size: 15px;">word2vec</a> <a href="/tags/torch/" style="font-size: 15px;">torch</a> <a href="/tags/torch-geometric/" style="font-size: 15px;">torch-geometric</a> <a href="/tags/多任务学习/" style="font-size: 15px;">多任务学习</a> <a href="/tags/图网络/" style="font-size: 15px;">图网络</a> <a href="/tags/矩阵补全/" style="font-size: 15px;">矩阵补全</a> <a href="/tags/推荐/" style="font-size: 15px;">推荐</a> <a href="/tags/NAS/" style="font-size: 15px;">NAS</a> <a href="/tags/网络修剪/" style="font-size: 15px;">网络修剪</a> <a href="/tags/知识迁移/" style="font-size: 15px;">知识迁移</a> <a href="/tags/神经架构搜索/" style="font-size: 15px;">神经架构搜索</a> <a href="/tags/async/" style="font-size: 15px;">async</a> <a href="/tags/异步/" style="font-size: 15px;">异步</a> <a href="/tags/多进程/" style="font-size: 15px;">多进程</a> <a href="/tags/流数据/" style="font-size: 15px;">流数据</a> <a href="/tags/概念漂移/" style="font-size: 15px;">概念漂移</a> <a href="/tags/二分搜索/" style="font-size: 15px;">二分搜索</a> <a href="/tags/univesal-embedding/" style="font-size: 15px;">univesal embedding</a> <a href="/tags/机器学习工具/" style="font-size: 15px;">机器学习工具</a> <a href="/tags/universal-embedding/" style="font-size: 15px;">universal embedding</a> <a href="/tags/迁移学习/" style="font-size: 15px;">迁移学习</a> <a href="/tags/逻辑/" style="font-size: 15px;">逻辑</a> <a href="/tags/github-blog/" style="font-size: 15px;">github blog</a> <a href="/tags/例行化/" style="font-size: 15px;">例行化</a> <a href="/tags/协同过滤/" style="font-size: 15px;">协同过滤</a> <a href="/tags/GCN/" style="font-size: 15px;">GCN</a> <a href="/tags/图卷积/" style="font-size: 15px;">图卷积</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/在线学习/" style="font-size: 15px;">在线学习</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">三月 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">九月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">八月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://petr-mitrichev.blogspot.com/" title="petr" target="_blank">petr</a><ul></ul><a href="http://blog.pluskid.org/" title="Free Mind" target="_blank">Free Mind</a><ul></ul><a href="http://www.flickering.cn/" title="火光摇曳" target="_blank">火光摇曳</a><ul></ul><a href="https://recsys.acm.org/" title="recsys" target="_blank">recsys</a><ul></ul><a href="https://sites.google.com/site/xreborner/" title="Xreborner" target="_blank">Xreborner</a><ul></ul><a href="http://blog.watashi.ws/" title="watashi" target="_blank">watashi</a><ul></ul><a href="https://toc.csail.mit.edu/user/306" title="WJMZBMR" target="_blank">WJMZBMR</a><ul></ul><a href="http://dongxicheng.org/" title="dongxicheng" target="_blank">dongxicheng</a><ul></ul><a href="https://www.byvoid.com/zht/" title="byvoid" target="_blank">byvoid</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">TiuVe.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><!-- 页面点击小红心，在末尾添加，避免找不到 -->
<script type="text/javascript" src="/js/love.js"></script>
<!-- 背景彩带, true打开，false关闭 --><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>