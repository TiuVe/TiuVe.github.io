<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力成为一名实力很强的小白"><title>Hive基础教程 | TiuVe</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=2.0.1"><link rel="stylesheet" type="text/css" href="/css/highlight.css?v=2.0.1"><link rel="Shortcut Icon" href="/favicon.ico"><link rel="bookmark" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="stylesheet" type="text/css" href="/css/donate.css"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Hive基础教程</h1><a id="logo" href="/.">TiuVe</a><p class="description">气蒸云梦泽，波撼岳阳城</p></div><div id="nav-menu"><a href="/." class="current"><i class="fa fa-home"> 首页</i></a><a href="/./archives/"><i class="fa fa-archive"> 归档</i></a><a href="/./about/about.html"><i class="fa fa-user"> 关于</i></a><a href="/./project/project.html"><i class="fa fa-archive"> work</i></a></div><div id="search-form"><div id="result-mask" class="hide"></div><label><input id="search-key" type="text" autocomplete="off" placeholder="搜索"></label><div id="result-wrap" class="hide"><div id="search-result"></div></div><div class="hide"><template id="search-tpl"><div class="item"><a href="/{path}" title="{title}"><div class="title">{title}</div><div class="time">{date}</div><div class="tags">{tags}</div></a></div></template></div></div></div><div id="layout" class="layout-g"><div class="layout-l"><div class="content_container"><div class="post"><h1 class="post-title">Hive基础教程</h1><div class="post-meta"><a href="/2018/11/06/Hive基础教程/#comments" class="comment-count"></a><p><span class="date">Nov 06, 2018</span><span><a href="/categories/Hive/" class="category">Hive</a></span></p></div><div class="post-content"><p>本来想对官方文档《<a href="https://cwiki.apache.org/confluence/display/Hive/Tutorial#Tutorial-Creating,Showing,Altering,andDroppingTables" target="_blank" rel="noopener">Hive Tutorial</a>》进行翻译整理的，但是发现网上已经有人做了这方面工作，就不重复造轮子了。将作者 strongyoung88 的博文转载了过来备查，建议查看原文《<a href="https://blog.csdn.net/strongyoung88/article/details/53743937" target="_blank" rel="noopener">Hive 教程（官方Tutorial）</a>》。</p>
<p>目录</p>
<ul>
<li>概念<ul>
<li>什么是 Hive</li>
<li>Hive 的局限</li>
<li>快速入门</li>
<li>数据单元</li>
<li>类型系统</li>
<li>内置运算符和函数</li>
<li>语言能力</li>
</ul>
</li>
<li>使用和示例<ul>
<li>创建、展示、修改、删除 hive 表</li>
<li>加载数据</li>
<li>查询和插入数据</li>
</ul>
</li>
</ul>
<h2 id="一-概念"><a href="#一-概念" class="headerlink" title="一 概念"></a>一 概念</h2><h3 id="1-1-Hive是什么"><a href="#1-1-Hive是什么" class="headerlink" title="1.1 Hive是什么"></a>1.1 Hive是什么</h3><p>Hive是一个基于Apache Hadoop的数据仓库。对于数据存储与处理，Hadoop提供了主要的扩展和容错能力。</p>
<p>Hive设计的初衷是：对于大量的数据，使得数据汇总，查询和分析更加简单。它提供了SQL，允许用户更加简单地进行查询，汇总和数据分析。同时，Hive的SQL给予了用户多种方式来集成自己的功能，然后做定制化的查询，例如用户自定义函数（User Defined Functions，UDFs).</p>
<h3 id="1-2-Hive不适合做什么"><a href="#1-2-Hive不适合做什么" class="headerlink" title="1.2 Hive不适合做什么"></a>1.2 Hive不适合做什么</h3><p>Hive不是为在线事务处理而设计。它最适合用于传统的数据仓库任务。</p>
<h3 id="1-3-Getting-Started"><a href="#1-3-Getting-Started" class="headerlink" title="1.3 Getting Started"></a>1.3 Getting Started</h3><p>对于Hive, HiveServer2 和Beeline的设置详情，请参考 <a href="https://cwiki.apache.org/confluence/display/Hive/GettingStarted" target="_blank" rel="noopener">指南</a> 。</p>
<p>对于学习Hive，这些 <a href="https://cwiki.apache.org/confluence/display/Hive/Books+about+Hive" target="_blank" rel="noopener">书单</a> 可能对你有所用处。</p>
<p>以下部分提供了一个关于Hive系统功能的教程。先描述数据类型，表和分区的概念，然后使用例子来描述Hive的功能。</p>
<h3 id="1-4-数据单元"><a href="#1-4-数据单元" class="headerlink" title="1.4 数据单元"></a>1.4 数据单元</h3><p>根据颗粒度的顺序，Hive数据被组织成： </p>
<ul>
<li><p><strong>数据库</strong>：命名空间功能，为了避免表，视图，分区，列等等的命名冲突。数据库也可以用于加强用户或用户组的安全。</p>
</li>
<li><p><strong>表</strong>：相同数据库的同类数据单元。例如表page_views，表的每行包含以下列：</p>
<ul>
<li>timestamp －这是一个INT类型，是当页面被访问时的UNIX时间戳。</li>
<li>userid －这是一个BIGINT类型，用于惟一识别访问页面的用户。</li>
<li>page_url －这是一个STRING类型，用于存储页面地址。</li>
<li>referer_url －这是一个STRING类型，用于存储用户是从哪个页面跳转到本页面的地址。</li>
<li>IP －这是一个STRING类型，用于存储页面请求的IP地址。</li>
</ul>
</li>
<li><p><strong>分区</strong>：每个表可以有一个或多个用于决定数据如何存储的分区键。分区（除存储单元之外）也允许用户有效地识别满足指定条件的行；例如，STRING类型的date_partition和STRING的country_partition。这些分区键的每个唯一的值定义了表的一个分区。例如，所有的“2009－12－23”日期的“US”数据是表page_views的一个分区。（注意区分，分区键与分区，如果分区键有两个，每个分区键有三个不同的值，则共有6个分区）。因此，如果你只在日期为“2009－12－23”的“US”数据上执行分析，你将只会在表的相关数据上执行查询，这将有效地加速分析。然而要注意，那仅仅是因为有个分区叫2009-12-23，并不意味着它包含了所有数据，或者说，这些数据仅仅是那个日期的数据。用户需要保证分区名字与数据内容之间的关系。分区列是虚拟列，它们不是数据本身的一部分，而是源于数据加载。</p>
</li>
<li><p><strong>桶</strong>（Buckets or Clusters）：每个分区的数据，基于表的一些列的哈希函数值，又被分割成桶。例如，表page_views可能通过userid分成桶，userid是表page_view的一个列，不同于分区列。这些桶可以被用于有效地抽样数据。</p>
</li>
</ul>
<h3 id="1-5-类型系统"><a href="#1-5-类型系统" class="headerlink" title="1.5 类型系统"></a>1.5 类型系统</h3><p>Hive支持原始类型和复要类型，如下所述，查看 <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+Types" target="_blank" rel="noopener">Hive Data Types</a>。</p>
<h4 id="1-5-1-原始类型"><a href="#1-5-1-原始类型" class="headerlink" title="1.5.1 原始类型"></a>1.5.1 原始类型</h4><p>类型与表的列相关。支持以下原始类型：</p>
<ul>
<li><p>Integers（整型） </p>
<ul>
<li>TINYINT －1位的整型</li>
<li>SMALLINT －2位的整型</li>
<li>INT －4位的整型</li>
<li>BIGINT －8位的整型</li>
</ul>
</li>
<li><p>布尔类型 </p>
<ul>
<li>BOOLEAN －TRUE&#x2F;FALSE</li>
</ul>
</li>
<li><p>浮点数 </p>
<ul>
<li>FLOAT －单精度</li>
<li>DOUBLE －双精度</li>
</ul>
</li>
<li><p>定点数 </p>
<ul>
<li>DECIMAL －用户可以指定范围和小数点位数</li>
</ul>
</li>
<li><p>字符串 </p>
<ul>
<li>STRING －在特定的字符集中的一个字符串序列 </li>
<li>VARCHAR －在特定的字符集中的一个有最大长度限制的字符串序列 </li>
<li>CHAR －在特定的字符集中的一个指定长度的字符串序列</li>
</ul>
</li>
<li><p>日期和时间 </p>
<ul>
<li>TIMESTAMP －一个特定的时间点，精确到纳秒。 </li>
<li>DATE －一个日期</li>
</ul>
</li>
<li><p>二进制 </p>
<ul>
<li>BINARY －一个二进制位序列</li>
</ul>
</li>
</ul>
<h4 id="1-5-2-复杂类型"><a href="#1-5-2-复杂类型" class="headerlink" title="1.5.2 复杂类型"></a>1.5.2 复杂类型</h4><p>复杂类型可以由原始类型和其他组合类型构建： </p>
<ul>
<li><strong>结构体类型</strong>（Stuct): 使用点（.)来访问类型内部的元素。例如，有一列c，它是一个结构体类型{a INT; b INT}，字段a可以使用表达式c.a来访问。 </li>
<li><strong>Map</strong>(key-value键值对)：使用[‘元素名’]来访问元素。例如，有一个MapM，包含’group’-&gt;gid的映射，则gid的值可以使用M[‘group’]来访问。 </li>
<li><strong>数组</strong>：数组中的元素是相同的类型。可以使用[n]来访问数组元素，n是数组下标，以0开始。例如有一个数组A，有元素[‘a’,’b’,’c’]，则A[1]返回’b’。</li>
</ul>
<h3 id="1-6-内置运算符和函数"><a href="#1-6-内置运算符和函数" class="headerlink" title="1.6 内置运算符和函数"></a>1.6 内置运算符和函数</h3><p>Hive所有关键词的大小写都不敏感，包括Hive运算符和函数的名字。</p>
<h4 id="1-6-1-内置运算符"><a href="#1-6-1-内置运算符" class="headerlink" title="1.6.1 内置运算符"></a>1.6.1 内置运算符</h4><p>关系运算 </p>
<p><img src="/images/20181108_2.png"></p>
<p>数学运算 </p>
<p><img src="/images/20181108_3.png"></p>
<p>逻辑运算 </p>
<p><img src="/images/20181108_4.png"></p>
<p>复杂类型的运算 </p>
<p><img src="/images/20181108_5.png"></p>
<h4 id="1-6-2-内置函数"><a href="#1-6-2-内置函数" class="headerlink" title="1.6.2 内置函数"></a>1.6.2 内置函数</h4><p>Hive支持以下内置函数 </p>
<p><img src="/images/20181108_6.png"></p>
<p>Hive支持以下内置聚合函数 </p>
<p><img src="/images/20181108_7.png"></p>
<h3 id="1-7-语言能力"><a href="#1-7-语言能力" class="headerlink" title="1.7 语言能力"></a>1.7 语言能力</h3><p>Hive’s SQL提供了基本的SQL操作。这些操作工作于表或分区上。这些操作是： </p>
<ul>
<li>可以使用WHERE从表中筛选行 </li>
<li>可以使用SELECT从表中查询指定的列 </li>
<li>两个表之间可以join </li>
<li>可以在多个group by的列上使用聚合 </li>
<li>可以存储查询结构到另一个表 </li>
<li>可以下载表的内容到本地目录 </li>
<li>可以存储查询结果到hadoop的分布式文件系统目录上 </li>
<li>可以管理表和分区（创建，删除和修改） </li>
<li>可以使用自定义的脚本，来定制map&#x2F;reduce作业</li>
</ul>
<h2 id="二-使用和实例"><a href="#二-使用和实例" class="headerlink" title="二 使用和实例"></a>二 使用和实例</h2><p>以下的例子有一些不是最新的，更多最新的信息，可以参考 <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual" target="_blank" rel="noopener">LanguageManual</a>。</p>
<p>以下的例子强调了Hive系统的显著特征。详细的查询测试用例和相应的查询结果可以在 <a href="http://svn.apache.org/viewvc/hive/trunk/ql/src/test/queries/clientpositive/" target="_blank" rel="noopener">Hive Query Test Cases</a> 上找到。</p>
<ul>
<li>创建，显示，修改，和删除表</li>
<li>加载数据</li>
<li>查询和插入数据</li>
</ul>
<h3 id="2-1-创建，显示，修改，和删除表"><a href="#2-1-创建，显示，修改，和删除表" class="headerlink" title="2.1 创建，显示，修改，和删除表"></a>2.1 创建，显示，修改，和删除表</h3><h4 id="2-1-1-创建表"><a href="#2-1-1-创建表" class="headerlink" title="2.1.1 创建表"></a>2.1.1 创建表</h4><p>以下例子创建表page_view：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">                page_url <span class="keyword">STRING</span>, referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">                ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>)</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'This is the page view table'</span></span><br><span class="line">PARTITIONED <span class="keyword">BY</span>(dt <span class="keyword">STRING</span>, country <span class="keyword">STRING</span>)</span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br></pre></td></tr></table></figure>

<p>在这个例子中，表的列被指定相应的类型。备注（Comments)可以基于列级别，也可以是表级别。另外，使用PARTITIONED关键词定义的分区列与数据列是不同的，分区列实际上不存储数据。当使用这种方式创建表的时候，我们假设数据文件的内容，字段之间以ASCII 001（ctrl-A)分隔，行之间以换行分隔。</p>
<p>如果数据不是以上述格式组织的，我们也可以指定分隔符，如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">                page_url <span class="keyword">STRING</span>, referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">                ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>)</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'This is the page view table'</span></span><br><span class="line">PARTITIONED <span class="keyword">BY</span>(dt <span class="keyword">STRING</span>, country <span class="keyword">STRING</span>)</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line">        <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'1'</span></span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br></pre></td></tr></table></figure>

<p>目前，行分隔符不能改变，因为它不是由Hive决定，而是由Hadoop分隔符。</p>
<p>对表的指定列进行分桶，是一个好的方法，它可以有效地对数据集进行抽样查询。如果没有分桶，则会进行随机抽样，由于在查询的时候，需要扫描所有数据，因此，效率不高。以下例子描述了，在表page_view的userid列上进行分桶的例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">                page_url <span class="keyword">STRING</span>, referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">                ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>)</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'This is the page view table'</span></span><br><span class="line">PARTITIONED <span class="keyword">BY</span>(dt <span class="keyword">STRING</span>, country <span class="keyword">STRING</span>)</span><br><span class="line">CLUSTERED <span class="keyword">BY</span>(userid) SORTED <span class="keyword">BY</span>(viewTime) <span class="keyword">INTO</span> <span class="number">32</span> BUCKETS</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line">        <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'1'</span></span><br><span class="line">        COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'2'</span></span><br><span class="line">        <span class="keyword">MAP</span> <span class="keyword">KEYS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'3'</span></span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br></pre></td></tr></table></figure>

<p>以上例子，通过一个userid的哈希函数，表被分成32个桶。在每个桶中的数据，是以viewTime升序进行存储。这样组织数据允许用户有效地在这n个桶上进行抽样。合适的排序使得内部操作充分利用熟悉的数据结构来进行更加有效的查询。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> page_view(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">                page_url <span class="keyword">STRING</span>, referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">                friends <span class="built_in">ARRAY</span>&lt;<span class="built_in">BIGINT</span>&gt;, properties <span class="keyword">MAP</span>&lt;<span class="keyword">STRING</span>, <span class="keyword">STRING</span>&gt;,</span><br><span class="line">                ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>)</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'This is the page view table'</span></span><br><span class="line">PARTITIONED <span class="keyword">BY</span>(dt <span class="keyword">STRING</span>, country <span class="keyword">STRING</span>)</span><br><span class="line">CLUSTERED <span class="keyword">BY</span>(userid) SORTED <span class="keyword">BY</span>(viewTime) <span class="keyword">INTO</span> <span class="number">32</span> BUCKETS</span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span></span><br><span class="line">        <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'1'</span></span><br><span class="line">        COLLECTION ITEMS <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'2'</span></span><br><span class="line">        <span class="keyword">MAP</span> <span class="keyword">KEYS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'3'</span></span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> SEQUENCEFILE;</span><br></pre></td></tr></table></figure>

<p>在这个例子，CLUSTERED BY指定列进行分桶，以及创建多少个桶。行格式分隔符指定在hive表中，行如何存储。在这种分隔符情况下，指定了字段是如何结束，集合项（数组和map）如何结束，以及map的key是如何结束的。STORED AS SEQUENCEFILE表示这个数据是以二进制格式进行存储数据在hdfs上。对于以上例子的ROW FORMAT的值和STORED AS表示系统默认值。</p>
<p>表名和列名不区分大小写。</p>
<h4 id="2-1-2-浏览表和分区"><a href="#2-1-2-浏览表和分区" class="headerlink" title="2.1.2 浏览表和分区"></a>2.1.2 浏览表和分区</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span>;</span><br></pre></td></tr></table></figure>

<p>列出数据库里的所有的表，也可以这么浏览：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">TABLES</span> <span class="string">'page.*'</span>;</span><br></pre></td></tr></table></figure>

<p>这样将会列出以page开头的表，模式遵循Java正则表达式语法。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span> <span class="keyword">PARTITIONS</span> page_view;</span><br></pre></td></tr></table></figure>

<p>列出表的分区。如果表没有分区，则抛出错误。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> page_view;</span><br></pre></td></tr></table></figure>

<p>列出表的列和列的类型。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> <span class="keyword">EXTENDED</span> page_view;</span><br></pre></td></tr></table></figure>

<p>列出表的列和表的其他属性。这会打印很多信息，且输出的风格不是很友好，通常用于调试。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DESCRIBE</span> <span class="keyword">EXTENDED</span> page_view <span class="keyword">PARTITION</span> (ds=<span class="string">'2016-08-08'</span>);</span><br></pre></td></tr></table></figure>

<p>列出列和分区的所有属性。这也会打印出许多信息，通常也是用于调试。</p>
<h4 id="2-1-3-修改表"><a href="#2-1-3-修改表" class="headerlink" title="2.1.3 修改表"></a>2.1.3 修改表</h4><p>对已有的表进行重命名。如果表的新名字存在，则报错：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> old_table_name <span class="keyword">RENAME</span> <span class="keyword">TO</span> new_table_name;</span><br></pre></td></tr></table></figure>

<p>对已有表的列名进行重命名。要确保使用相同的列类型，且要包含对每个已存在列的一个入口(也就是说，就算不修改其他列的列名，也要把此列另上，否则，此列会丢失）。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> old_table_name <span class="keyword">REPLACE</span> <span class="keyword">COLUMNS</span> (col1 <span class="keyword">TYPE</span>, ...);</span><br></pre></td></tr></table></figure>

<p>对已有表增加列：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tab1 <span class="keyword">ADD</span> <span class="keyword">COLUMNS</span> (c1 <span class="built_in">INT</span> <span class="keyword">COMMENT</span> <span class="string">'a new int column'</span>, c2 <span class="keyword">STRING</span> <span class="keyword">DEFAULT</span> <span class="string">'def val'</span>);</span><br></pre></td></tr></table></figure>

<p>注意：<br>模式的改变（例如增加列），保留了表的老分区，以免它是一个分区表。所有对这些列或老分区的查询都会隐式地返回一个null值或这些列指定的默认值。</p>
<h4 id="2-1-4-删除表和分区"><a href="#2-1-4-删除表和分区" class="headerlink" title="2.1.4 删除表和分区"></a>2.1.4 删除表和分区</h4><p>删除表是相当，表的删除会删除已经建立在表上的任意索引。相关命令是：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> pv_users;</span><br></pre></td></tr></table></figure>

<p>要删除分区。修改表删除分区：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> pv_users <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> (ds=<span class="string">'2016-08-08'</span>)</span><br></pre></td></tr></table></figure>

<p>注意：此表或分区的任意数据都将被删除，而且可能无法恢复。</p>
<h3 id="2-2-加载数据"><a href="#2-2-加载数据" class="headerlink" title="2.2 加载数据"></a>2.2 加载数据</h3><p>要加载数据到Hive表有许多种方式。用户可以创建一个“外部表”来指向一个特定的HDFS路径。用这种方法，用户可以使用HDFSput或copy命令，复制一个文件到指定的位置，并且附上相应的行格式信息创建一个表指定这个位置。一旦完成，用户就可以转换数据和插入他们到任意其他的Hive表中。例如，如果文件&#x2F;tmp&#x2F;pv_2016-06-08.txt包含逗号分隔的页面访问记录。这需要以合适的分区加载到表page_view，以下命令可以完成这个目标：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> page_view_stg(viewTime <span class="built_in">INT</span>, userid <span class="built_in">BIGINT</span>,</span><br><span class="line">                page_url <span class="keyword">STRING</span>, referrer_url <span class="keyword">STRING</span>,</span><br><span class="line">                ip <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'IP Address of the User'</span>,</span><br><span class="line">                country <span class="keyword">STRING</span> <span class="keyword">COMMENT</span> <span class="string">'country of origination'</span>)</span><br><span class="line"><span class="keyword">COMMENT</span> <span class="string">'This is the staging page view table'</span></span><br><span class="line"><span class="keyword">ROW</span> <span class="keyword">FORMAT</span> <span class="keyword">DELIMITED</span> <span class="keyword">FIELDS</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'44'</span> <span class="keyword">LINES</span> <span class="keyword">TERMINATED</span> <span class="keyword">BY</span> <span class="string">'12'</span></span><br><span class="line"><span class="keyword">STORED</span> <span class="keyword">AS</span> TEXTFILE</span><br><span class="line">LOCATION <span class="string">'/user/data/staging/page_view'</span>;</span><br><span class="line"></span><br><span class="line">hadoop dfs -put /tmp/pv_2016-06-08.txt /user/data/staging/page_view</span><br><span class="line"></span><br><span class="line">FROM page_view_stg pvs</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> page_view <span class="keyword">PARTITION</span>(dt=<span class="string">'2016-06-08'</span>, country=<span class="string">'US'</span>)</span><br><span class="line"><span class="keyword">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="literal">null</span>, <span class="literal">null</span>, pvs.ip</span><br><span class="line"><span class="keyword">WHERE</span> pvs.country = <span class="string">'US'</span>;</span><br></pre></td></tr></table></figure>

<p>其中，‘44’是逗号的ASCII码，‘12’是换页符（NP from feed,new page）。null是作为目标表中的数组和map类型插入，如果指定了合适的行格式，这些值也可以来自外部表。</p>
<p>如果在HDFS上有一些历史数据，用户想增加一些元数据，以便于可以使用Hive来查询和操纵这些数据，这个方法是很有用的。</p>
<p>另外，系统也支持直接从本地文件系统上加载数据到Hive表。表的格式与输入文件的格式需要相同。如果文件&#x2F;tmp&#x2F;pv_2016-06-08包含了US数据，然后我们不需要像前面例子那样的任何筛选，这种情况的加载可以使用以下语法完成：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> <span class="keyword">LOCAL</span> INPATH /tmp/pv_2016<span class="number">-06</span><span class="number">-08</span>_us.txt <span class="keyword">INTO</span> <span class="keyword">TABLE</span> page_view <span class="keyword">PARTITION</span>(<span class="built_in">date</span>=<span class="string">'2016-06-08'</span>, country=<span class="string">'US'</span>)</span><br></pre></td></tr></table></figure>

<p>路径参数可以是一个目录（这种情况下，目录下的所有文件将被加载），一个文件，或一个通配符（这种情况下，所有匹配的文件会上传）。如果参数是目录，它不能包含子目录。同样，通配符只匹配文件名。</p>
<p>在输入文件&#x2F;tmp&#x2F;pv_2016-06-08.txt非常大的情况下，用户可以采用并行加载数据的方式（使用Hive的外部工具）。只要文件在HDFS上－以下语法可以用于加载数据到Hive表：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LOAD</span> <span class="keyword">DATA</span> INPATH <span class="string">'/user/data/pv_2016-06-08_us.txt'</span> <span class="keyword">INTO</span> <span class="keyword">TABLE</span> page_view <span class="keyword">PARTITION</span>(<span class="built_in">date</span>=<span class="string">'2016-06-08'</span>, country=<span class="string">'US'</span>)</span><br></pre></td></tr></table></figure>

<p>对于这个例子，我们假设数组和map在文件中的值为null。</p>
<p>更多关于加载数据到表的信息，请参考 <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DML" target="_blank" rel="noopener">Hive Data Manipulation Language</a>,创建外部表的另外一个例子请参考 <a href="https://cwiki.apache.org/confluence/display/Hive/LanguageManual+DDL#LanguageManualDDL-ExternalTables" target="_blank" rel="noopener">External Tables</a>。</p>
<h3 id="2-3-查询和插入数据"><a href="#2-3-查询和插入数据" class="headerlink" title="2.3 查询和插入数据"></a>2.3 查询和插入数据</h3><ul>
<li>Simple Query</li>
<li>Partition Based Query</li>
<li>Joins</li>
<li>Aggregations</li>
<li>Multi Table&#x2F;File Inserts</li>
<li>Dynamic-Partition Insert</li>
<li>Inserting into Local Files</li>
<li>Sampling</li>
<li>Union All</li>
<li>Array Operations</li>
<li>Map (Associative Arrays) Operations</li>
<li>Custom Map&#x2F;Reduce Scripts</li>
<li>Co-Groups</li>
</ul>
<p>Hive查询操作在文档Select,插入操作在文档insert data into Hive Tables from queries和writing data into the filesystem from queries。</p>
<h4 id="2-3-1-简单的查询"><a href="#2-3-1-简单的查询" class="headerlink" title="2.3.1 简单的查询"></a>2.3.1 简单的查询</h4><p>对于所有的活跃用户，可以使用以下查询格式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> user_active</span><br><span class="line"><span class="keyword">SELECT</span> user.*</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> user.active = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>注意：不像SQL，我们老是插入结果到表中。随后我们会描述，用户如何检查这些结果，甚至把结果导出到一个本地文件。你也可以在Beeline或HiveCLI执行以下查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> user.*</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span></span><br><span class="line"><span class="keyword">WHERE</span> user.active = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<p>这在内部将会重写到一些临时文件，并在Hive客户端显示。</p>
<h4 id="2-3-2-基于查询的分区"><a href="#2-3-2-基于查询的分区" class="headerlink" title="2.3.2 基于查询的分区"></a>2.3.2 基于查询的分区</h4><p>在一个查询中，要使用什么分区，是由系统根据where在分区列上条件自动的决定。例如，为了获取所有2008年3月份，从域名xyz.com过来的page_views，可以这么写查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> xyz_com_page_views</span><br><span class="line"><span class="keyword">SELECT</span> page_views.*</span><br><span class="line"><span class="keyword">FROM</span> page_views</span><br><span class="line"><span class="keyword">WHERE</span> page_views.date &gt;= <span class="string">'2008-03-01'</span> <span class="keyword">AND</span> page_views.date &lt;= <span class="string">'2008-03-31'</span> <span class="keyword">AND</span></span><br><span class="line">      page_views.referrer_url <span class="keyword">like</span> <span class="string">'%xyz.com'</span>;</span><br></pre></td></tr></table></figure>

<p>注意：在这里使用的page_views.date是用PARTITIONED BY(date DATATIME, country STRING)定义的.如果你的分区命名不一样，那么不要指望.date能够做你想做的事情，即无法获得分区的优势。</p>
<h4 id="2-3-3-连接"><a href="#2-3-3-连接" class="headerlink" title="2.3.3 连接"></a>2.3.3 连接</h4><p>表的连接可以使用以下命令：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_users</span><br><span class="line"><span class="keyword">SELECT</span> pv.*, u.gender, u.age</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span> u <span class="keyword">JOIN</span> page_view pv <span class="keyword">ON</span> (pv.userid = u.id)</span><br><span class="line"><span class="keyword">WHERE</span> pv.date = <span class="string">'2008-03-03'</span>;</span><br></pre></td></tr></table></figure>

<p>想实现外连接，用户可以使用LEFT OUTER,RIGHT OUTER或FULL OUTER关键词来指示不同的外连接（左保留，右保留或两端都保留）。例如，想对上面的查询做一个FULL OUTER，相应的语法可以像下面这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_users</span><br><span class="line"><span class="keyword">SELECT</span> pv.*, u.gender, u.age</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span> u <span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> page_view pv <span class="keyword">ON</span> (pv.userid = u.id)</span><br><span class="line"><span class="keyword">WHERE</span> pv.date = <span class="string">'2008-03-03'</span>;</span><br></pre></td></tr></table></figure>

<p>为了检查key在另外一个表中是否存在，用户可以使用LEFT SEMI JOIN,正如以下例子一样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_users</span><br><span class="line"><span class="keyword">SELECT</span> u.*</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">user</span> u <span class="keyword">LEFT</span> <span class="keyword">SEMI</span> <span class="keyword">JOIN</span> page_view pv <span class="keyword">ON</span> (pv.userid = u.id)</span><br><span class="line"><span class="keyword">WHERE</span> pv.date = <span class="string">'2008-03-03'</span>;</span><br></pre></td></tr></table></figure>

<p>为了连接多个表，可以使用以下语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_friends</span><br><span class="line"><span class="keyword">SELECT</span> pv.*, u.gender, u.age, f.friends</span><br><span class="line"><span class="keyword">FROM</span> page_view pv <span class="keyword">JOIN</span> <span class="keyword">user</span> u <span class="keyword">ON</span> (pv.userid = u.id) <span class="keyword">JOIN</span> friend_list f <span class="keyword">ON</span> (u.id = f.uid)</span><br><span class="line"><span class="keyword">WHERE</span> pv.date = <span class="string">'2008-03-03'</span>;</span><br></pre></td></tr></table></figure>

<p>注意：Hive只支持equi-joins。所以，把最大的表放在join的最右边，可以得到最好的性能。</p>
<h4 id="2-3-4-聚合"><a href="#2-3-4-聚合" class="headerlink" title="2.3.4 聚合"></a>2.3.4 聚合</h4><p>统计用户每个性别的人数，可以使用以下查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_gender_sum</span><br><span class="line"><span class="keyword">SELECT</span> pv_users.gender, <span class="keyword">count</span> (<span class="keyword">DISTINCT</span> pv_users.userid)</span><br><span class="line"><span class="keyword">FROM</span> pv_users</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> pv_users.gender;</span><br></pre></td></tr></table></figure>

<p>可以同时做多个聚合，然而，两个聚合函数不能同时用DISTINCT作用于不同的列，以下情况是可以的（DISTINCT作用于相同列）：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_gender_agg</span><br><span class="line"><span class="keyword">SELECT</span> pv_users.gender, <span class="keyword">count</span>(<span class="keyword">DISTINCT</span> pv_users.userid), <span class="keyword">count</span>(*), <span class="keyword">sum</span>(<span class="keyword">DISTINCT</span> pv_users.userid)</span><br><span class="line"><span class="keyword">FROM</span> pv_users</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> pv_users.gender;</span><br></pre></td></tr></table></figure>

<p>然而，以下情况（DISTINCT作用于不同的列）是不允许的：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_gender_agg</span><br><span class="line"><span class="keyword">SELECT</span> pv_users.gender, <span class="keyword">count</span>(<span class="keyword">DISTINCT</span> pv_users.userid), <span class="keyword">count</span>(<span class="keyword">DISTINCT</span> pv_users.ip)</span><br><span class="line"><span class="keyword">FROM</span> pv_users</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> pv_users.gender;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-5-多表-x2F-文件插入"><a href="#2-3-5-多表-x2F-文件插入" class="headerlink" title="2.3.5 多表&#x2F;文件插入"></a>2.3.5 多表&#x2F;文件插入</h4><p>聚合或简单查询的输出可以插入到多个表中，或者甚至是HDFS文件（能够使用HDFS工具进行操纵）。例如，如果沿用前面的“性别分类”，例子如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">FROM pv_users</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_gender_sum</span><br><span class="line">    <span class="keyword">SELECT</span> pv_users.gender, count_distinct(pv_users.userid)</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> pv_users.gender</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">DIRECTORY</span> <span class="string">'/user/data/tmp/pv_age_sum'</span></span><br><span class="line">    <span class="keyword">SELECT</span> pv_users.age, count_distinct(pv_users.userid)</span><br><span class="line">    <span class="keyword">GROUP</span> <span class="keyword">BY</span> pv_users.age;</span><br></pre></td></tr></table></figure>

<p>第一个插入语句将结果插入到Hive表中，而第二个插入语句是将结果写到HDFS文件。</p>
<h4 id="2-3-6-动态分区插入"><a href="#2-3-6-动态分区插入" class="headerlink" title="2.3.6 动态分区插入"></a>2.3.6 动态分区插入</h4><p>在前面的例子中，我们知道，在插入语句中，只能有一个分区。如果我们想加载到多个分区，我们必须像以下描述来使用多条插入语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">FROM page_view_stg pvs</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> page_view <span class="keyword">PARTITION</span>(dt=<span class="string">'2008-06-08'</span>, country=<span class="string">'US'</span>)</span><br><span class="line">       <span class="keyword">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="literal">null</span>, <span class="literal">null</span>, pvs.ip <span class="keyword">WHERE</span> pvs.country = <span class="string">'US'</span></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> page_view <span class="keyword">PARTITION</span>(dt=<span class="string">'2008-06-08'</span>, country=<span class="string">'CA'</span>)</span><br><span class="line">       <span class="keyword">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="literal">null</span>, <span class="literal">null</span>, pvs.ip <span class="keyword">WHERE</span> pvs.country = <span class="string">'CA'</span></span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> page_view <span class="keyword">PARTITION</span>(dt=<span class="string">'2008-06-08'</span>, country=<span class="string">'UK'</span>)</span><br><span class="line">       <span class="keyword">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="literal">null</span>, <span class="literal">null</span>, pvs.ip <span class="keyword">WHERE</span> pvs.country = <span class="string">'UK'</span>;</span><br></pre></td></tr></table></figure>

<p>为了加载数据到全部的country分区到指定的日期。我们必须在输入数据中为每个country增加一条插入语句。这是非常不方便的，因为我们需要提前创建且知道已存在哪些country分区列表。如果哪天这些country列表变了，我们必须修改我们的插入语句，也应该创建相应的分区。这也是非常低效的，因为每个插入语句可能都是转换成一个MapReduce作业。</p>
<p>动态分区插入（Dynamic-partition insert)(或multi-partition插入)就是为了解决以上问题而设计的，它通过动态地决定在扫描数据的时候，哪些分区应该创建和填充。这个新的特征是在版本0.6.0加入的。在动态分区插入中，输入列被评估，这行应该插入到哪个分区。如果分区没有创建，它将自动创建这个分区。使用这个特征，我们仅仅需要插入语桀犬吠尧来创建和填充所有需要的分区。另外，因为只有一个插入语句，相应的也只有一个MapReduce作业。相比多个插入语句的情况，这将显著地提高性能且降低Hadoop集群负载。</p>
<p>以下是使用一个插入语句，加载数据到所有country分区的例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM page_view_stg pvs</span><br><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> page_view <span class="keyword">PARTITION</span>(dt=<span class="string">'2008-06-08'</span>, country)</span><br><span class="line">       <span class="keyword">SELECT</span> pvs.viewTime, pvs.userid, pvs.page_url, pvs.referrer_url, <span class="literal">null</span>, <span class="literal">null</span>, pvs.ip, pvs.country</span><br></pre></td></tr></table></figure>

<p>与多条插入语句相比，动态分区插入有一些语法上的不同： </p>
<ul>
<li>country出现在PARTITION后面，但是没有具体的值。这种情况，country就是一个动态分区列。另一方面，dt有一个值，这意味着它是一个静态的分区列。如果一个列是动态分区列，它的值将会使用输入列的值。目前，我们仅仅允许在分区条件的最后一列放置动态分区列，因为分区列的顺序，指示了它的层级次序（意味着dt是根分区，country是子分区）。我们不能这样指定分区（dt,country&#x3D;’US’)，因为这表示，我们需要更新所有的日期的分区且它的country子分区是‘US’。</li>
<li>一个额外的pvs.country列被加入在查询语句中。这对动态分区列来说，相当于输入列。注意：对于静态分区列，我们不需要添加一个输入列，因为在PARTITION语句中，它的值已经知道。注意：动态分区列的值（不是名字）查出来是有序的，且是放在select语句的最后。</li>
</ul>
<p>动态分区插入的语义： </p>
<ul>
<li>对于动态分区列，当已经此分区时，（例如，country&#x3D;’CA’已存在dt根分区下面）如果动态分区插入与输入数据中相同的值（’CA’），它将会被重写（overwritten)。</li>
</ul>
<h4 id="2-3-7-插入到本地文件"><a href="#2-3-7-插入到本地文件" class="headerlink" title="2.3.7 插入到本地文件"></a>2.3.7 插入到本地文件</h4><p>在某些场合，我们需要把输出写到一个本地文件，以便于能用excel表格打开。这可以使用以下命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">INSERT OVERWRITE LOCAL DIRECTORY &apos;/tmp/pv_gender_sum&apos;</span><br><span class="line">SELECT pv_gender_sum.*</span><br><span class="line">FROM pv_gender_sum;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-8-抽样"><a href="#2-3-8-抽样" class="headerlink" title="2.3.8 抽样"></a>2.3.8 抽样</h4><p>抽样语句允许用户对数据抽样查询，而不是全表查询。当前，抽样是对那些在CREATE TABLE语句的CLUSTERED BY修饰的列上。以下例子，我们从表pv_gender_sum表中的32个桶中，选择第3个桶。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_gender_sum_sample</span><br><span class="line"><span class="keyword">SELECT</span> pv_gender_sum.*</span><br><span class="line"><span class="keyword">FROM</span> pv_gender_sum <span class="keyword">TABLESAMPLE</span>(<span class="keyword">BUCKET</span> <span class="number">3</span> <span class="keyword">OUT</span> <span class="keyword">OF</span> <span class="number">32</span>);</span><br></pre></td></tr></table></figure>

<p>通常，TABLESAMPLE的语法像这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLESAMPLE(BUCKET x OUT OF y)</span><br></pre></td></tr></table></figure>

<p>这个y必须是桶的数量的因子或倍数，桶的数量是在创建表的时候指定的。抽样所选的桶由桶大小，y和x共同决定。如果y和桶大小相等，则抽样所选的桶是x对y的求模结果。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLESAMPLE(BUCKET 3 OUT OF 16)</span><br></pre></td></tr></table></figure>

<p>这将抽样第3个和第19个桶。桶的编号从0开始。</p>
<p>tablesample语句的另一方面：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TABLESAMPLE(BUCKET 3 OUT OF 64 ON userid)</span><br></pre></td></tr></table></figure>

<p>这将抽取第3个桶的一半。</p>
<h4 id="2-3-9-union-all"><a href="#2-3-9-union-all" class="headerlink" title="2.3.9 union all"></a>2.3.9 union all</h4><p>这个语言也支持union all，如果假设我们有两个不同的表，分别用来记录用户发布的视频和用户发布的评论，以下例子是一个union all 的结果与用户表再连接的查询：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> actions_users</span><br><span class="line"><span class="keyword">SELECT</span> u.id, actions.date</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line">    <span class="keyword">SELECT</span> av.uid <span class="keyword">AS</span> uid</span><br><span class="line">    <span class="keyword">FROM</span> action_video av</span><br><span class="line">    <span class="keyword">WHERE</span> av.date = <span class="string">'2008-06-03'</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">SELECT</span> ac.uid <span class="keyword">AS</span> uid</span><br><span class="line">    <span class="keyword">FROM</span> action_comment ac</span><br><span class="line">    <span class="keyword">WHERE</span> ac.date = <span class="string">'2008-06-03'</span></span><br><span class="line">    ) actions <span class="keyword">JOIN</span> <span class="keyword">users</span> u <span class="keyword">ON</span>(u.id = actions.uid);</span><br></pre></td></tr></table></figure>

<h4 id="2-3-10-数组操作"><a href="#2-3-10-数组操作" class="headerlink" title="2.3.10 数组操作"></a>2.3.10 数组操作</h4><p>表的数组列可以这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> array_table (int_array_column <span class="built_in">ARRAY</span>&lt;<span class="built_in">INT</span>&gt;);</span><br></pre></td></tr></table></figure>

<p>假设pv.friends 是类型ARRAY<int>（也就是一个整型数组），用户可以通过索引号获取数组中特定的元素，如下：</int></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pv.friends[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">FROM</span> page_views pv;</span><br></pre></td></tr></table></figure>

<p>这个查询得到的是pv.friends里的第三个元素。</p>
<p>用户也可以使用函数size来获取数组的长度，如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> pv.userid, <span class="keyword">size</span>(pv.friends)</span><br><span class="line"><span class="keyword">FROM</span> page_view pv;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-11-Map（关联数组）操作"><a href="#2-3-11-Map（关联数组）操作" class="headerlink" title="2.3.11 Map（关联数组）操作"></a>2.3.11 Map（关联数组）操作</h4><p>Map提供了类似于关联数组的集合。这样的结构不仅可以由程序创建。我们也将很快可以继承这个。假设pv.properties是类型map&lt;String,String&gt;，如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> OVERWRITE page_views_map</span><br><span class="line"><span class="keyword">SELECT</span> pv.userid, pv.properties[<span class="string">'page type'</span>]</span><br><span class="line"><span class="keyword">FROM</span> page_views pv;</span><br></pre></td></tr></table></figure>

<p>这将查询表page_views的‘page_type‘属性。</p>
<p>与数组相似，也可以使用函数size来获取map的大小：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">size</span>(pv.properties)</span><br><span class="line"><span class="keyword">FROM</span> page_view pv;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-12-定制Map-x2F-Reduce脚本"><a href="#2-3-12-定制Map-x2F-Reduce脚本" class="headerlink" title="2.3.12 定制Map&#x2F;Reduce脚本"></a>2.3.12 定制Map&#x2F;Reduce脚本</h4><p>通过使用Hive语言原生支持的特征，用户可以插入他们自己定制的mapper和reducer在数据流中。例如，要运行一个定制的mapper脚本script-map_script和reducer脚本script-reduce_script)，用户可以执行以下命令，使用TRANSFORM来嵌入mapper和reducer脚本。</p>
<p>注意：在执行用户脚本之前，表的列会转换成字符串，且由TAB分隔，用户脚本的标准输出将会被作为以TAB分隔的字符串列。用户脚本可以输出调试信息到标准错误输出，这个信息也将显示hadoop的详细任务页面上。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">FROM (</span><br><span class="line">     FROM pv_users</span><br><span class="line">     MAP pv_users.userid, pv_users.date</span><br><span class="line">     USING 'map_script'</span><br><span class="line">     AS dt, uid</span><br><span class="line">     CLUSTER BY dt) map_output</span><br><span class="line"></span><br><span class="line"> <span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> pv_users_reduced</span><br><span class="line">     REDUCE map_output.dt, map_output.uid</span><br><span class="line">     <span class="keyword">USING</span> <span class="string">'reduce_script'</span></span><br><span class="line">     <span class="keyword">AS</span> <span class="built_in">date</span>, <span class="keyword">count</span>;</span><br></pre></td></tr></table></figure>

<p>map脚本样本（weekday_mapper.py)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">import datetime</span><br><span class="line"></span><br><span class="line">for line in sys.stdin:</span><br><span class="line">  line = line.strip()</span><br><span class="line">  userid, unixtime = line.split('\t')</span><br><span class="line">  weekday = datetime.datetime.fromtimestamp(float(unixtime)).isoweekday()</span><br><span class="line">  print ','.join([userid, str(weekday)])</span><br></pre></td></tr></table></figure>

<p>当然，对于那些常见的select转换，MAP和REDUCE都是“语法糖”。内部查询也可以写成这样：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> TRANSFORM(pv_users.userid, pv_users.date) <span class="keyword">USING</span> <span class="string">'map_script'</span> <span class="keyword">AS</span> dt, uid CLUSTER <span class="keyword">BY</span> dt <span class="keyword">FROM</span> pv_users;</span><br></pre></td></tr></table></figure>

<h4 id="2-3-13-Co-Groups"><a href="#2-3-13-Co-Groups" class="headerlink" title="2.3.13 Co-Groups"></a>2.3.13 Co-Groups</h4><p>在使用map&#x2F;reduce的群体中，cogroup是相当常见的操作，它是将来自多个表的数据发送到一个定制的reducer，使得行由表的指定列的值进行分组。在Hive的查询语言中，可以使用以下方式，通过使用union all和cluster by来实现此功能。假设我们想对来自表actions_video和action_comment的行对uid列进行分组，且需要发送他们到reducer_script定制的reducer，可以使用以下语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FROM (</span><br><span class="line">     FROM (</span><br><span class="line">             FROM action_video av</span><br><span class="line">             <span class="keyword">SELECT</span> av.uid <span class="keyword">AS</span> uid, av.id <span class="keyword">AS</span> <span class="keyword">id</span>, av.date <span class="keyword">AS</span> <span class="built_in">date</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"></span><br><span class="line">             <span class="keyword">FROM</span> action_comment ac</span><br><span class="line">             <span class="keyword">SELECT</span> ac.uid <span class="keyword">AS</span> uid, ac.id <span class="keyword">AS</span> <span class="keyword">id</span>, ac.date <span class="keyword">AS</span> <span class="built_in">date</span></span><br><span class="line">     ) union_actions</span><br><span class="line">     <span class="keyword">SELECT</span> union_actions.uid, union_actions.id, union_actions.date</span><br><span class="line">     CLUSTER <span class="keyword">BY</span> union_actions.uid) <span class="keyword">map</span></span><br><span class="line"></span><br><span class="line"> <span class="keyword">INSERT</span> OVERWRITE <span class="keyword">TABLE</span> actions_reduced</span><br><span class="line">     <span class="keyword">SELECT</span> TRANSFORM(map.uid, map.id, map.date) <span class="keyword">USING</span> <span class="string">'reduce_script'</span> <span class="keyword">AS</span> (uid, <span class="keyword">id</span>, reduced_val);</span><br></pre></td></tr></table></figure>

</div><div class="tags"><a href="/tags/hive/">hive</a></div><script type="text/javascript" src="/js/jquery.js?v=2.0.1" async></script><div class="post-donate"><div id="donate_board" class="donate_bar center"><a id="btn_donate" href="javascript:;" title="打赏" class="btn_donate"></a><div class="donate_txt"> &uarr;<br>谢谢~ 您的支持将鼓励我继续创作！<br></div></div><div id="donate_guide" class="donate_bar center hidden pay"><img src="/img/weChatMoney.png" title="微信打赏" alt="微信打赏"><img src="/img/alipayMoney.png" title="支付宝打赏" alt="支付宝打赏"></div><script type="text/javascript">document.getElementById('btn_donate').onclick = function(){
    $('#donate_board').addClass('hidden');
    $('#donate_guide').removeClass('hidden');
}</script></div><div class="post-share"><div class="bdsharebuttonbox"><span style="float:left;line-height: 28px;height: 28px;font-size:16px;font-weight:blod">分享到：</span><a href="#" data-cmd="more" class="bds_more"></a><a href="#" data-cmd="mshare" title="分享到一键分享" class="bds_mshare"></a><a href="#" data-cmd="fbook" title="分享到Facebook" class="bds_fbook"></a><a href="#" data-cmd="twi" title="分享到Twitter" class="bds_twi"></a><a href="#" data-cmd="linkedin" title="分享到linkedin" class="bds_linkedin"></a><a href="#" data-cmd="youdao" title="分享到有道云笔记" class="bds_youdao"></a><a href="#" data-cmd="evernotecn" title="分享到印象笔记" class="bds_evernotecn"></a><a href="#" data-cmd="weixin" title="分享到微信" class="bds_weixin"></a><a href="#" data-cmd="qzone" title="分享到QQ空间" class="bds_qzone"></a><a href="#" data-cmd="tsina" title="分享到新浪微博" class="bds_tsina"></a></div></div><div class="post-nav"><a href="/2018/11/07/Mac下sublime安装及常用配置/" class="pre">Mac下sublime安装及常用配置</a><a href="/2018/11/01/spark程序优化/" class="next">spark程序设计优化</a></div><div id="comments"><div id="lv-container" data-id="city" data-uid="MTAyMC80MTIyOC8xNzc3Ng=="></div></div></div></div></div><div class="layout-r"><div id="sidebar"><div class="search-pla"></div><div id="toc" class="widget"><div class="widget-title"><i class="fa fa-fei">文章目录</i></div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#一-概念"><span class="toc-text">一 概念</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-1-Hive是什么"><span class="toc-text">1.1 Hive是什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-2-Hive不适合做什么"><span class="toc-text">1.2 Hive不适合做什么</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-3-Getting-Started"><span class="toc-text">1.3 Getting Started</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-4-数据单元"><span class="toc-text">1.4 数据单元</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-5-类型系统"><span class="toc-text">1.5 类型系统</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-1-原始类型"><span class="toc-text">1.5.1 原始类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-2-复杂类型"><span class="toc-text">1.5.2 复杂类型</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-6-内置运算符和函数"><span class="toc-text">1.6 内置运算符和函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-1-内置运算符"><span class="toc-text">1.6.1 内置运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-2-内置函数"><span class="toc-text">1.6.2 内置函数</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-7-语言能力"><span class="toc-text">1.7 语言能力</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#二-使用和实例"><span class="toc-text">二 使用和实例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-创建，显示，修改，和删除表"><span class="toc-text">2.1 创建，显示，修改，和删除表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-1-创建表"><span class="toc-text">2.1.1 创建表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-2-浏览表和分区"><span class="toc-text">2.1.2 浏览表和分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-3-修改表"><span class="toc-text">2.1.3 修改表</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-4-删除表和分区"><span class="toc-text">2.1.4 删除表和分区</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-加载数据"><span class="toc-text">2.2 加载数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-查询和插入数据"><span class="toc-text">2.3 查询和插入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-1-简单的查询"><span class="toc-text">2.3.1 简单的查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-2-基于查询的分区"><span class="toc-text">2.3.2 基于查询的分区</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-3-连接"><span class="toc-text">2.3.3 连接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-4-聚合"><span class="toc-text">2.3.4 聚合</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-5-多表-x2F-文件插入"><span class="toc-text">2.3.5 多表/文件插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-6-动态分区插入"><span class="toc-text">2.3.6 动态分区插入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-7-插入到本地文件"><span class="toc-text">2.3.7 插入到本地文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-8-抽样"><span class="toc-text">2.3.8 抽样</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-9-union-all"><span class="toc-text">2.3.9 union all</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-10-数组操作"><span class="toc-text">2.3.10 数组操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-11-Map（关联数组）操作"><span class="toc-text">2.3.11 Map（关联数组）操作</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-12-定制Map-x2F-Reduce脚本"><span class="toc-text">2.3.12 定制Map/Reduce脚本</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-13-Co-Groups"><span class="toc-text">2.3.13 Co-Groups</span></a></li></ol></li></ol></li></ol></div><div class="widget"><div class="widget-title"><i class="fa fa-xie"> 最新文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2022/07/03/《Towards-Universal-Sequence-Representation-Learning-for-Recommender-Systems》论文阅读笔记/">《Towards Universal Sequence Representation Learning for Recommender Systems》论文阅读笔记</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/07/NLP相关资料整理/">NLP相关资料整理</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/05/hexo博客链接在微信被屏蔽的解决办法/">hexo博客链接在微信被屏蔽的解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/05/TensorFlow的自动求导具体是在哪部分代码里实现的？/">TensorFlow的自动求导具体是在哪部分代码里实现的？</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/05/tf中如何修改tensor的值/">tf中如何修改tensor的值</a></li><li class="post-list-item"><a class="post-list-link" href="/2022/01/04/解决tf1-15中tf-scatter-update-函数没有定义梯度的问题/">解决tf1.15中tf.scatter_update()函数没有定义梯度的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/31/解决hexo博客代码在IOS下字体过大的问题/">解决hexo博客代码在IOS下字体过大的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/30/记一次悲催的tf报错/">记一次悲催的tf报错</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/12/17/tensorboard中的Smoothing/">tensorboard中的Smoothing</a></li><li class="post-list-item"><a class="post-list-link" href="/2021/11/25/如何打包maven项目中的配置文件和依赖/">如何打包maven项目中的配置文件和依赖</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-gui"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Algorithm/">Algorithm</a><span class="category-list-count">22</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/DMMLAI/">DMMLAI</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo主题/">Hexo主题</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hive/">Hive</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/PL/">PL</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Story/">Story</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/hole/">hole</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/mac/">mac</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/pytorch/">pytorch</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/sklearn/">sklearn</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tensorflow/">tensorflow</a><span class="category-list-count">10</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/例行化/">例行化</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/大数据/">大数据</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发/">开发</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/开发工具/">开发工具</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/推荐/">推荐</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/摄影/">摄影</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/数据获取/">数据获取</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/机器学习/">机器学习</a><span class="category-list-count">13</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/深度学习/">深度学习</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/游记/">游记</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/爬虫/">爬虫</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/统计学/">统计学</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计划/">计划</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/计算广告/">计算广告</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/高并发/">高并发</a><span class="category-list-count">1</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-biao"> 标签</i></div><div class="tagcloud"><a href="/tags/思考/" style="font-size: 15px;">思考</a> <a href="/tags/cold/" style="font-size: 15px;">cold</a> <a href="/tags/gwen/" style="font-size: 15px;">gwen</a> <a href="/tags/C-C/" style="font-size: 15px;">C/C++</a> <a href="/tags/FTRL/" style="font-size: 15px;">FTRL</a> <a href="/tags/hive/" style="font-size: 15px;">hive</a> <a href="/tags/FM/" style="font-size: 15px;">FM</a> <a href="/tags/kmp/" style="font-size: 15px;">kmp</a> <a href="/tags/字符串匹配/" style="font-size: 15px;">字符串匹配</a> <a href="/tags/Java编程思想/" style="font-size: 15px;">Java编程思想</a> <a href="/tags/L2范数，范数/" style="font-size: 15px;">L2范数，范数</a> <a href="/tags/linux性能管理/" style="font-size: 15px;">linux性能管理</a> <a href="/tags/NLP/" style="font-size: 15px;">NLP</a> <a href="/tags/TFRecord/" style="font-size: 15px;">TFRecord</a> <a href="/tags/tensorflow/" style="font-size: 15px;">tensorflow</a> <a href="/tags/自动求导，自动微分/" style="font-size: 15px;">自动求导，自动微分</a> <a href="/tags/指标/" style="font-size: 15px;">指标</a> <a href="/tags/auc/" style="font-size: 15px;">auc</a> <a href="/tags/cpm/" style="font-size: 15px;">cpm</a> <a href="/tags/opcm/" style="font-size: 15px;">opcm</a> <a href="/tags/ecpm/" style="font-size: 15px;">ecpm</a> <a href="/tags/zookepper/" style="font-size: 15px;">zookepper</a> <a href="/tags/centos7/" style="font-size: 15px;">centos7</a> <a href="/tags/sublime/" style="font-size: 15px;">sublime</a> <a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/hexo，微信屏蔽/" style="font-size: 15px;">hexo，微信屏蔽</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/tf/" style="font-size: 15px;">tf</a> <a href="/tags/正则表达式/" style="font-size: 15px;">正则表达式</a> <a href="/tags/重装系统/" style="font-size: 15px;">重装系统</a> <a href="/tags/OJ/" style="font-size: 15px;">OJ</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/dfs/" style="font-size: 15px;">dfs</a> <a href="/tags/递归/" style="font-size: 15px;">递归</a> <a href="/tags/poj/" style="font-size: 15px;">poj</a> <a href="/tags/回文字符串/" style="font-size: 15px;">回文字符串</a> <a href="/tags/dp/" style="font-size: 15px;">dp</a> <a href="/tags/暴力/" style="font-size: 15px;">暴力</a> <a href="/tags/棋盘规则/" style="font-size: 15px;">棋盘规则</a> <a href="/tags/质数/" style="font-size: 15px;">质数</a> <a href="/tags/素数/" style="font-size: 15px;">素数</a> <a href="/tags/状态压缩/" style="font-size: 15px;">状态压缩</a> <a href="/tags/BFS/" style="font-size: 15px;">BFS</a> <a href="/tags/位运算/" style="font-size: 15px;">位运算</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/pytorch/" style="font-size: 15px;">pytorch</a> <a href="/tags/module/" style="font-size: 15px;">module</a> <a href="/tags/roc-auc-score/" style="font-size: 15px;">roc_auc_score</a> <a href="/tags/python/" style="font-size: 15px;">python</a> <a href="/tags/sklearn/" style="font-size: 15px;">sklearn</a> <a href="/tags/hole/" style="font-size: 15px;">hole</a> <a href="/tags/spark/" style="font-size: 15px;">spark</a> <a href="/tags/打散/" style="font-size: 15px;">打散</a> <a href="/tags/svm多类别分类/" style="font-size: 15px;">svm多类别分类</a> <a href="/tags/网格搜索/" style="font-size: 15px;">网格搜索</a> <a href="/tags/textFile/" style="font-size: 15px;">textFile</a> <a href="/tags/源码剖析/" style="font-size: 15px;">源码剖析</a> <a href="/tags/rdd计算/" style="font-size: 15px;">rdd计算</a> <a href="/tags/shell/" style="font-size: 15px;">shell</a> <a href="/tags/smoothing/" style="font-size: 15px;">smoothing</a> <a href="/tags/tensorboard/" style="font-size: 15px;">tensorboard</a> <a href="/tags/tf-nn/" style="font-size: 15px;">tf.nn</a> <a href="/tags/test-in-ubuntu/" style="font-size: 15px;">test in ubuntu</a> <a href="/tags/gather/" style="font-size: 15px;">gather</a> <a href="/tags/cnn/" style="font-size: 15px;">cnn</a> <a href="/tags/tensor/" style="font-size: 15px;">tensor</a> <a href="/tags/trie/" style="font-size: 15px;">trie</a> <a href="/tags/transformer/" style="font-size: 15px;">transformer</a> <a href="/tags/nlp/" style="font-size: 15px;">nlp</a> <a href="/tags/torch/" style="font-size: 15px;">torch</a> <a href="/tags/torch-geometric/" style="font-size: 15px;">torch-geometric</a> <a href="/tags/word2vec/" style="font-size: 15px;">word2vec</a> <a href="/tags/多任务学习/" style="font-size: 15px;">多任务学习</a> <a href="/tags/NAS/" style="font-size: 15px;">NAS</a> <a href="/tags/网络修剪/" style="font-size: 15px;">网络修剪</a> <a href="/tags/知识迁移/" style="font-size: 15px;">知识迁移</a> <a href="/tags/神经架构搜索/" style="font-size: 15px;">神经架构搜索</a> <a href="/tags/图网络/" style="font-size: 15px;">图网络</a> <a href="/tags/矩阵补全/" style="font-size: 15px;">矩阵补全</a> <a href="/tags/推荐/" style="font-size: 15px;">推荐</a> <a href="/tags/async/" style="font-size: 15px;">async</a> <a href="/tags/异步/" style="font-size: 15px;">异步</a> <a href="/tags/多进程/" style="font-size: 15px;">多进程</a> <a href="/tags/流数据/" style="font-size: 15px;">流数据</a> <a href="/tags/概念漂移/" style="font-size: 15px;">概念漂移</a> <a href="/tags/二分搜索/" style="font-size: 15px;">二分搜索</a> <a href="/tags/机器学习工具/" style="font-size: 15px;">机器学习工具</a> <a href="/tags/逻辑/" style="font-size: 15px;">逻辑</a> <a href="/tags/例行化/" style="font-size: 15px;">例行化</a> <a href="/tags/协同过滤/" style="font-size: 15px;">协同过滤</a> <a href="/tags/github-blog/" style="font-size: 15px;">github blog</a> <a href="/tags/GCN/" style="font-size: 15px;">GCN</a> <a href="/tags/图卷积/" style="font-size: 15px;">图卷积</a> <a href="/tags/github/" style="font-size: 15px;">github</a> <a href="/tags/在线学习/" style="font-size: 15px;">在线学习</a> <a href="/tags/PLE/" style="font-size: 15px;">PLE</a> <a href="/tags/评估指标/" style="font-size: 15px;">评估指标</a> <a href="/tags/多标签分类/" style="font-size: 15px;">多标签分类</a> <a href="/tags/mac/" style="font-size: 15px;">mac</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-archive"> 归档</i></div><ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">一月 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">十一月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">八月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">二月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">十一月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">十月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">九月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">二月 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">十一月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">七月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">十二月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">十月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">七月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">四月 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">四月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/11/">十一月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">十月 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/11/">十一月 2014</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-you"> 友情链接</i></div><ul></ul><a href="https://petr-mitrichev.blogspot.com/" title="petr" target="_blank">petr</a><ul></ul><a href="http://blog.pluskid.org/" title="Free Mind" target="_blank">Free Mind</a><ul></ul><a href="http://www.flickering.cn/" title="火光摇曳" target="_blank">火光摇曳</a><ul></ul><a href="https://recsys.acm.org/" title="recsys" target="_blank">recsys</a><ul></ul><a href="https://sites.google.com/site/xreborner/" title="Xreborner" target="_blank">Xreborner</a><ul></ul><a href="http://blog.watashi.ws/" title="watashi" target="_blank">watashi</a><ul></ul><a href="https://toc.csail.mit.edu/user/306" title="WJMZBMR" target="_blank">WJMZBMR</a><ul></ul><a href="http://dongxicheng.org/" title="dongxicheng" target="_blank">dongxicheng</a><ul></ul><a href="https://www.byvoid.com/zht/" title="byvoid" target="_blank">byvoid</a></div></div></div></div><a id="totop" href="#top"></a><div id="footer"><div class="footer-info"><p><a href="/baidusitemap.xml">Baidu Site Haritası</a> |  <a href="/atom.xml">订阅</a> |  <a href="/about/">关于</a></p><p><span> Copyright &copy;<a href="/." rel="nofollow">TiuVe.</a></span><span> Theme by<a rel="nofollow" target="_blank" href="https://github.com/chaooo/hexo-theme-BlueLake"> BlueLake.</a></span><span> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></span></p></div></div></div><script type="text/javascript" src="/js/search.json.js?v=2.0.1"></script><!-- 页面点击小红心，在末尾添加，避免找不到 -->
<script type="text/javascript" src="/js/love.js"></script>
<!-- 背景彩带, true打开，false关闭 --><script type="text/javascript" src="/js/toctotop.js?v=2.0.1" async></script><script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":["mshare","weixin","tsina","qzone","linkedin","fbook","twi","print","renren","sqq","evernotecn","bdysc","tqq","tqf","bdxc","kaixin001","tieba","douban","bdhome","thx","ibaidu","meilishuo","mogujie","diandian","huaban","duitang","hx","fx","youdao","sdo","qingbiji","people","xinhua","mail","isohu","yaolan","wealink","ty","iguba","h163","copy"],"bdPic":"","bdStyle":"1","bdSize":"16"},"share":{},"image":{"viewList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["tsina","qzone","weixin","fbook","twi","linkedin","youdao","evernotecn","mshare"]}};with(document)0[(getElementsByTagName('head')[0]||head).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
</script><script>(function(d, s) {
  var j, e = d.getElementsByTagName('body')[0];
  if (typeof LivereTower === 'function') { return; }
  j = d.createElement(s);
  j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
  j.async = true;
  e.appendChild(j);
})(document, 'script');
</script><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"jsonPath":"/live2dw/assets/Epsilon2.1.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":false},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body></html>